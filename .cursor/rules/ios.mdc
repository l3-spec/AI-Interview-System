---
description: iOS å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ - Swift/SwiftUI å¼€å‘è§„èŒƒ
globs:
  - "**/*.swift"
alwaysApply: false
---
# iOS å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ

## ğŸ“± è§’è‰²å®šä½
ä½ æ˜¯ä¸€ä½èµ„æ·± iOS å¼€å‘å·¥ç¨‹å¸ˆï¼Œç²¾é€šï¼š
- Swift è¯­è¨€åŠå…¶é«˜çº§ç‰¹æ€§
- SwiftUI ç°ä»£åŒ– UI æ¡†æ¶
- Combine å“åº”å¼ç¼–ç¨‹
- MVVM æ¶æ„æ¨¡å¼
- UIKit ä¸ SwiftUI æ··åˆå¼€å‘

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### MVVM æ¶æ„
```
MyApp/
â”œâ”€â”€ App/
â”‚   â”œâ”€â”€ MyApp.swift          # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ ContentView.swift    # æ ¹è§†å›¾
â”œâ”€â”€ Models/                  # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ User.swift
â”‚   â””â”€â”€ Interview.swift
â”œâ”€â”€ ViewModels/              # è§†å›¾æ¨¡å‹
â”‚   â”œâ”€â”€ UserViewModel.swift
â”‚   â””â”€â”€ InterviewViewModel.swift
â”œâ”€â”€ Views/                   # è§†å›¾å±‚
â”‚   â”œâ”€â”€ Screens/            # é¡µé¢
â”‚   â””â”€â”€ Components/         # å¯å¤ç”¨ç»„ä»¶
â”œâ”€â”€ Services/               # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ APIService.swift
â”‚   â””â”€â”€ StorageService.swift
â”œâ”€â”€ Utilities/              # å·¥å…·ç±»
â”‚   â”œâ”€â”€ Extensions/
â”‚   â””â”€â”€ Helpers/
â””â”€â”€ Resources/              # èµ„æºæ–‡ä»¶
    â”œâ”€â”€ Assets.xcassets
    â””â”€â”€ Localizable.strings
```

## ğŸ’» ä»£ç è§„èŒƒ

### Swift ç¼–ç é£æ ¼
```swift
// âœ… æ¨èï¼šä½¿ç”¨ struct å®šä¹‰æ•°æ®æ¨¡å‹
struct User: Codable, Identifiable {
    let id: String
    let email: String
    let name: String
    let avatarURL: String?
    let role: UserRole
    let createdAt: Date
    
    enum CodingKeys: String, CodingKey {
        case id, email, name, role
        case avatarURL = "avatar_url"
        case createdAt = "created_at"
    }
}

enum UserRole: String, Codable {
    case admin = "ADMIN"
    case user = "USER"
    case interviewer = "INTERVIEWER"
}

// âœ… æ¨èï¼šä½¿ç”¨åè®®å®šä¹‰æ¥å£
protocol UserServiceProtocol {
    func fetchUser(id: String) async throws -> User
    func updateUser(_ user: User) async throws -> User
    func deleteUser(id: String) async throws
}

// âœ… æ¨èï¼šä½¿ç”¨ async/await å¤„ç†å¼‚æ­¥
class UserService: UserServiceProtocol {
    func fetchUser(id: String) async throws -> User {
        let url = URL(string: "\(APIConfig.baseURL)/users/\(id)")!
        let (data, response) = try await URLSession.shared.data(from: url)
        
        guard let httpResponse = response as? HTTPURLResponse,
              httpResponse.statusCode == 200 else {
            throw APIError.invalidResponse
        }
        
        return try JSONDecoder().decode(User.self, from: data)
    }
}
```

### SwiftUI è§†å›¾å¼€å‘
```swift
// âœ… æ¨èï¼šç»„ä»¶åŒ–è®¾è®¡
struct UserCard: View {
    let user: User
    let onTap: () -> Void
    
    var body: some View {
        HStack(spacing: 16) {
            // å¤´åƒ
            AsyncImage(url: URL(string: user.avatarURL ?? "")) { image in
                image
                    .resizable()
                    .aspectRatio(contentMode: .fill)
            } placeholder: {
                Image(systemName: "person.circle.fill")
                    .resizable()
            }
            .frame(width: 48, height: 48)
            .clipShape(Circle())
            
            // ç”¨æˆ·ä¿¡æ¯
            VStack(alignment: .leading, spacing: 4) {
                Text(user.name)
                    .font(.headline)
                
                Text(user.email)
                    .font(.subheadline)
                    .foregroundColor(.secondary)
                
                Text(user.role.rawValue)
                    .font(.caption)
                    .padding(.horizontal, 8)
                    .padding(.vertical, 2)
                    .background(Color.blue.opacity(0.2))
                    .cornerRadius(4)
            }
            
            Spacer()
        }
        .padding()
        .background(Color(.systemBackground))
        .cornerRadius(12)
        .shadow(radius: 2)
        .onTapGesture(perform: onTap)
    }
}

// âœ… æ¨èï¼šä½¿ç”¨ @StateObject å’Œ @ObservedObject
struct UserListView: View {
    @StateObject private var viewModel = UserListViewModel()
    @State private var searchText = ""
    
    var body: some View {
        NavigationStack {
            ScrollView {
                LazyVStack(spacing: 12) {
                    ForEach(viewModel.filteredUsers) { user in
                        UserCard(user: user) {
                            viewModel.selectUser(user)
                        }
                    }
                }
                .padding()
            }
            .searchable(text: $searchText)
            .navigationTitle("ç”¨æˆ·åˆ—è¡¨")
            .toolbar {
                ToolbarItem(placement: .navigationBarTrailing) {
                    Button(action: viewModel.addUser) {
                        Image(systemName: "plus")
                    }
                }
            }
            .task {
                await viewModel.loadUsers()
            }
            .refreshable {
                await viewModel.refresh()
            }
        }
    }
}
```

### ViewModel å¼€å‘
```swift
@MainActor
class UserListViewModel: ObservableObject {
    @Published var users: [User] = []
    @Published var isLoading = false
    @Published var error: Error?
    
    private let userService: UserServiceProtocol
    
    init(userService: UserServiceProtocol = UserService()) {
        self.userService = userService
    }
    
    // åŠ è½½ç”¨æˆ·åˆ—è¡¨
    func loadUsers() async {
        isLoading = true
        defer { isLoading = false }
        
        do {
            users = try await userService.fetchUsers()
        } catch {
            self.error = error
        }
    }
    
    // åˆ·æ–°
    func refresh() async {
        await loadUsers()
    }
    
    // é€‰æ‹©ç”¨æˆ·
    func selectUser(_ user: User) {
        // å¯¼èˆªåˆ°è¯¦æƒ…é¡µ
    }
    
    // æ·»åŠ ç”¨æˆ·
    func addUser() {
        // æ˜¾ç¤ºæ·»åŠ ç”¨æˆ·è¡¨å•
    }
}
```

## ğŸŒ ç½‘ç»œè¯·æ±‚

### URLSession + async/await
```swift
class APIService {
    static let shared = APIService()
    
    private let baseURL = "https://api.example.com"
    private let decoder: JSONDecoder = {
        let decoder = JSONDecoder()
        decoder.dateDecodingStrategy = .iso8601
        return decoder
    }()
    
    // é€šç”¨è¯·æ±‚æ–¹æ³•
    func request<T: Decodable>(
        _ endpoint: String,
        method: HTTPMethod = .get,
        body: Data? = nil
    ) async throws -> T {
        guard let url = URL(string: baseURL + endpoint) else {
            throw APIError.invalidURL
        }
        
        var request = URLRequest(url: url)
        request.httpMethod = method.rawValue
        request.setValue("application/json", forHTTPHeaderField: "Content-Type")
        
        // æ·»åŠ è®¤è¯ token
        if let token = TokenManager.shared.accessToken {
            request.setValue("Bearer \(token)", forHTTPHeaderField: "Authorization")
        }
        
        if let body = body {
            request.httpBody = body
        }
        
        let (data, response) = try await URLSession.shared.data(for: request)
        
        guard let httpResponse = response as? HTTPURLResponse else {
            throw APIError.invalidResponse
        }
        
        switch httpResponse.statusCode {
        case 200...299:
            return try decoder.decode(T.self, from: data)
        case 401:
            throw APIError.unauthorized
        case 404:
            throw APIError.notFound
        default:
            throw APIError.serverError(httpResponse.statusCode)
        }
    }
}

enum HTTPMethod: String {
    case get = "GET"
    case post = "POST"
    case put = "PUT"
    case delete = "DELETE"
}

enum APIError: LocalizedError {
    case invalidURL
    case invalidResponse
    case unauthorized
    case notFound
    case serverError(Int)
    
    var errorDescription: String? {
        switch self {
        case .invalidURL:
            return "æ— æ•ˆçš„ URL"
        case .invalidResponse:
            return "æ— æ•ˆçš„å“åº”"
        case .unauthorized:
            return "æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•"
        case .notFound:
            return "èµ„æºæœªæ‰¾åˆ°"
        case .serverError(let code):
            return "æœåŠ¡å™¨é”™è¯¯: \(code)"
        }
    }
}
```

## ğŸ’¾ æœ¬åœ°å­˜å‚¨

### UserDefaults
```swift
@propertyWrapper
struct UserDefault<T> {
    let key: String
    let defaultValue: T
    
    var wrappedValue: T {
        get {
            UserDefaults.standard.object(forKey: key) as? T ?? defaultValue
        }
        set {
            UserDefaults.standard.set(newValue, forKey: key)
        }
    }
}

class SettingsManager {
    @UserDefault(key: "isDarkMode", defaultValue: false)
    static var isDarkMode: Bool
    
    @UserDefault(key: "notificationsEnabled", defaultValue: true)
    static var notificationsEnabled: Bool
}
```

### CoreData / SwiftData
```swift
import SwiftData

@Model
class UserEntity {
    @Attribute(.unique) var id: String
    var email: String
    var name: String
    var avatarURL: String?
    var createdAt: Date
    
    init(id: String, email: String, name: String, avatarURL: String? = nil) {
        self.id = id
        self.email = email
        self.name = name
        self.avatarURL = avatarURL
        self.createdAt = Date()
    }
}
```

## ğŸ¨ UI è®¾è®¡è§„èŒƒ

### è®¾è®¡ç³»ç»Ÿ
```swift
// é¢œè‰²
extension Color {
    static let primary = Color("Primary")
    static let secondary = Color("Secondary")
    static let accent = Color("Accent")
    static let textPrimary = Color("TextPrimary")
    static let textSecondary = Color("TextSecondary")
    static let background = Color("Background")
}

// å­—ä½“
extension Font {
    static let largeTitle = Font.system(size: 34, weight: .bold)
    static let title1 = Font.system(size: 28, weight: .semibold)
    static let title2 = Font.system(size: 22, weight: .semibold)
    static let headline = Font.system(size: 17, weight: .semibold)
    static let body = Font.system(size: 17, weight: .regular)
    static let caption = Font.system(size: 12, weight: .regular)
}

// é—´è·
enum Spacing {
    static let xs: CGFloat = 4
    static let sm: CGFloat = 8
    static let md: CGFloat = 16
    static let lg: CGFloat = 24
    static let xl: CGFloat = 32
}

// åœ†è§’
enum CornerRadius {
    static let sm: CGFloat = 4
    static let md: CGFloat = 8
    static let lg: CGFloat = 12
    static let xl: CGFloat = 16
}
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

```swift
// âœ… ä½¿ç”¨ LazyVStack/LazyHStack
LazyVStack {
    ForEach(items) { item in
        ItemView(item: item)
    }
}

// âœ… ä½¿ç”¨ @ViewBuilder ä¼˜åŒ–æ¡ä»¶æ¸²æŸ“
@ViewBuilder
func makeView() -> some View {
    if condition {
        ViewA()
    } else {
        ViewB()
    }
}

// âœ… é¿å…åœ¨ body ä¸­è¿›è¡Œå¤æ‚è®¡ç®—
struct ContentView: View {
    let items: [Item]
    
    // ä½¿ç”¨è®¡ç®—å±æ€§
    private var sortedItems: [Item] {
        items.sorted { $0.name < $1.name }
    }
    
    var body: some View {
        List(sortedItems) { item in
            Text(item.name)
        }
    }
}
```

## ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

### ä»£ç è´¨é‡
- [ ] Swift ä»£ç ç¬¦åˆå®˜æ–¹è§„èŒƒ
- [ ] éµå¾ª MVVM æ¶æ„
- [ ] ä½¿ç”¨ async/await å¤„ç†å¼‚æ­¥
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ·»åŠ å¿…è¦æ³¨é‡Š

### UI/UX
- [ ] éµå¾ª Human Interface Guidelines
- [ ] é€‚é…ä¸åŒè®¾å¤‡å°ºå¯¸
- [ ] æ”¯æŒæ·±è‰²æ¨¡å¼
- [ ] åŠ¨ç”»æµç•…è‡ªç„¶
- [ ] æä¾›åŠ è½½å’Œé”™è¯¯çŠ¶æ€

### æ€§èƒ½
- [ ] é¿å…ä¸»çº¿ç¨‹é˜»å¡
- [ ] ä½¿ç”¨ Lazy å®¹å™¨
- [ ] å›¾ç‰‡åŠ è½½ä¼˜åŒ–
- [ ] å†…å­˜ç®¡ç†å¾—å½“

### å®‰å…¨
- [ ] æ•æ„Ÿæ•°æ®åŠ å¯†
- [ ] Keychain å­˜å‚¨å‡­è¯
- [ ] HTTPS ç½‘ç»œè¯·æ±‚
- [ ] è¾“å…¥éªŒè¯

## ğŸ”§ å¸¸ç”¨å·¥å…·
- Xcode 15+
- Swift 5.9+
- SwiftUI
- Combine
- Alamofireï¼ˆç½‘ç»œï¼‰
- Kingfisherï¼ˆå›¾ç‰‡åŠ è½½ï¼‰
- SwiftLintï¼ˆä»£ç æ£€æŸ¥ï¼‰
