# OpenAvatarChat 云端部署系统要求

## 📋 系统要求概览

### 基础要求（必需）

| 组件 | 要求 | 说明 |
|------|------|------|
| **操作系统** | Ubuntu 20.04+ / Ubuntu 22.04 LTS | 推荐 Ubuntu 22.04 LTS |
| **Python** | 3.11.7 - 3.11.14 | 不支持 3.12+ |
| **GPU** | NVIDIA GPU（推荐） | 用于数字人渲染加速 |
| **CUDA** | >= 12.4 | 推荐 CUDA 12.8 |
| **显存** | 最低 4GB，推荐 8GB+ | 根据配置而定 |
| **内存** | 最低 8GB，推荐 16GB+ | 推荐 32GB |
| **存储** | 最低 50GB，推荐 100GB+ | SSD推荐 |
| **网络** | 公网IP + 带宽 >= 10Mbps | 用于RTC传输 |

---

## 🎯 不同配置方案的系统要求

### 方案一：完整本地推理（最高性能）

**适用场景**：高性能需求，不希望依赖外部API

| 资源 | 最低配置 | 推荐配置 | 说明 |
|------|---------|---------|------|
| **CPU** | 8核 | 16核+ | Intel/AMD x86_64 |
| **内存** | 16GB | 32GB+ | DDR4 |
| **GPU** | RTX 3060 (8GB) | RTX 4090 (24GB) | NVIDIA |
| **显存** | 8GB | 16GB+ | 用于LiteAvatar + ASR |
| **存储** | 100GB SSD | 200GB+ NVMe SSD | 模型存储 |
| **网络** | 10Mbps | 50Mbps+ | 公网带宽 |

**成本估算**：
- 阿里云：ECS g6e.2xlarge（8核32GB，8GB显存）≈ ¥800-1200/月
- 腾讯云：GN10Xp.2XLARGE32 ≈ ¥900-1300/月

---

### 方案二：云端API配置（推荐，最低成本）

**适用场景**：降低服务器成本，使用云端ASR/LLM/TTS

| 资源 | 最低配置 | 推荐配置 | 说明 |
|------|---------|---------|------|
| **CPU** | 4核 | 8核+ | 用于VAD和数字人渲染 |
| **内存** | 8GB | 16GB | 足够运行LiteAvatar |
| **GPU** | RTX 3060 (6GB) | RTX 3090 (12GB) | 仅用于数字人渲染 |
| **显存** | 6GB | 12GB+ | LiteAvatar需要3GB/路 |
| **存储** | 50GB SSD | 100GB SSD | 基础存储 |
| **网络** | 10Mbps | 20Mbps+ | 公网带宽 |

**成本估算**：
- 阿里云：ECS g6e.xlarge（4核16GB，6GB显存）≈ ¥400-600/月
- 腾讯云：GN10Xp.XLARGE16 ≈ ¥450-700/月
- **API费用**：
  - 阿里云ASR：¥0.01/分钟
  - DeepSeek LLM：¥0.14/1M tokens（约¥0.01/次对话）
  - CosyVoice TTS：¥0.01/千字符

**优势**：
- ✅ 服务器成本降低50-70%
- ✅ 扩展性好（API按需付费）
- ✅ 维护简单（无需管理模型）

---

### 方案三：CPU模式（最低成本，性能受限）

**适用场景**：预算有限，可以接受较低性能

| 资源 | 最低配置 | 推荐配置 | 说明 |
|------|---------|---------|------|
| **CPU** | 8核 | 16核+ | 用于CPU推理 |
| **内存** | 16GB | 32GB+ | CPU模式需要更多内存 |
| **GPU** | 无 | 无 | 不使用GPU |
| **存储** | 50GB SSD | 100GB SSD | 基础存储 |
| **网络** | 10Mbps | 20Mbps+ | 公网带宽 |

**成本估算**：
- 阿里云：ECS ecs.c7.2xlarge（8核32GB）≈ ¥300-500/月
- 腾讯云：S5.2XLARGE32 ≈ ¥350-550/月

**性能说明**：
- ⚠️ LiteAvatar CPU模式：约15-20 FPS（vs GPU 25-30 FPS）
- ⚠️ 延迟增加：约增加0.5-1秒
- ⚠️ 并发能力：单路（vs GPU 2-3路）

---

### 方案四：Docker容器部署（推荐部署方式）

**系统要求**：与方案一/二相同，但使用Docker容器

**额外要求**：
- Docker >= 20.10
- Docker Compose >= 2.0
- NVIDIA Container Toolkit（GPU支持）

**优势**：
- ✅ 环境隔离，易于部署
- ✅ 版本管理简单
- ✅ 易于迁移和扩展

---

## 🖥️ 具体云服务器推荐配置

### 阿里云推荐配置

#### 方案A：GPU实例（推荐）
```
实例规格：ecs.gn6i-c4g1.xlarge
- CPU: 4核
- 内存: 16GB
- GPU: NVIDIA T4 (16GB显存)
- 带宽: 5Mbps
- 存储: 100GB SSD云盘
价格：约 ¥800-1000/月
```

#### 方案B：GPU实例（高性能）
```
实例规格：ecs.gn6i-c8g1.2xlarge
- CPU: 8核
- 内存: 32GB
- GPU: NVIDIA T4 (16GB显存)
- 带宽: 10Mbps
- 存储: 200GB SSD云盘
价格：约 ¥1500-2000/月
```

#### 方案C：CPU实例（低成本）
```
实例规格：ecs.c7.2xlarge
- CPU: 8核
- 内存: 32GB
- GPU: 无
- 带宽: 5Mbps
- 存储: 100GB SSD云盘
价格：约 ¥400-600/月
```

### 腾讯云推荐配置

#### 方案A：GPU实例（推荐）
```
实例规格：GN10Xp.XLARGE16
- CPU: 4核
- 内存: 16GB
- GPU: NVIDIA P100 (16GB显存)
- 带宽: 5Mbps
- 存储: 100GB SSD云盘
价格：约 ¥750-950/月
```

#### 方案B：GPU实例（高性能）
```
实例规格：GN10Xp.2XLARGE32
- CPU: 8核
- 内存: 32GB
- GPU: NVIDIA P100 (16GB显存)
- 带宽: 10Mbps
- 存储: 200GB SSD云盘
价格：约 ¥1400-1800/月
```

### AWS推荐配置

#### 方案A：GPU实例
```
实例类型：g4dn.xlarge
- CPU: 4核
- 内存: 16GB
- GPU: NVIDIA T4 (16GB显存)
- 存储: 100GB EBS SSD
价格：约 $150-200/月（约¥1000-1400）
```

---

## 🔧 系统安装步骤

### 1. 基础环境准备

```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装基础工具
sudo apt install -y \
    git \
    git-lfs \
    curl \
    wget \
    build-essential \
    python3.11 \
    python3.11-venv \
    python3-pip \
    docker.io \
    docker-compose

# 安装Git LFS（必需）
sudo apt install git-lfs
git lfs install
```

### 2. 安装NVIDIA驱动和CUDA（GPU服务器）

```bash
# 添加NVIDIA驱动仓库
sudo add-apt-repository ppa:graphics-drivers/ppa
sudo apt update

# 安装NVIDIA驱动（推荐版本 >= 535）
sudo apt install -y nvidia-driver-535

# 安装CUDA 12.8
wget https://developer.download.nvidia.com/compute/cuda/12.8.0/local_installers/cuda_12.8.0_550.54.15_linux.run
sudo sh cuda_12.8.0_550.54.15_linux.run

# 配置环境变量
echo 'export PATH=/usr/local/cuda-12.8/bin:$PATH' >> ~/.bashrc
echo 'export LD_LIBRARY_PATH=/usr/local/cuda-12.8/lib64:$LD_LIBRARY_PATH' >> ~/.bashrc
source ~/.bashrc

# 验证安装
nvidia-smi
nvcc --version
```

### 3. 安装Docker和NVIDIA Container Toolkit

```bash
# 安装Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# 安装NVIDIA Container Toolkit
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list

sudo apt-get update
sudo apt-get install -y nvidia-container-toolkit
sudo systemctl restart docker

# 验证GPU支持
docker run --rm --gpus all nvidia/cuda:12.8.0-base-ubuntu22.04 nvidia-smi
```

### 4. 部署OpenAvatarChat

```bash
# 克隆项目
git clone https://github.com/HumanAIGC-Engineering/OpenAvatarChat.git
cd OpenAvatarChat

# 更新子模块
git submodule update --init --recursive --depth 1

# 下载模型（根据需要）
bash scripts/download_liteavatar_weights.sh

# 使用Docker部署（推荐）
bash build_cuda128.sh
bash run_docker_cuda128.sh --config config/chat_with_openai_compatible_bailian_cosyvoice.yaml
```

---

## 💰 成本对比分析

### 方案对比（按月）

| 方案 | 服务器成本 | API成本 | 总成本 | 适用场景 |
|------|-----------|---------|--------|---------|
| **完整本地推理** | ¥800-1200 | ¥0 | ¥800-1200 | 高并发，长期使用 |
| **云端API配置** | ¥400-600 | ¥100-300 | ¥500-900 | 中等并发，推荐 |
| **CPU模式** | ¥300-500 | ¥0 | ¥300-500 | 低并发，预算有限 |

### API成本估算（按1000次对话/天）

- **ASR（SenseVoice）**：1000次 × 1分钟 × ¥0.01 = ¥10/天 ≈ ¥300/月
- **LLM（DeepSeek）**：1000次 × 500 tokens × ¥0.14/1M = ¥0.07/天 ≈ ¥2/月
- **TTS（CosyVoice）**：1000次 × 200字符 × ¥0.01/千字符 = ¥2/天 ≈ ¥60/月

**总计API成本**：约 ¥360/月（按1000次对话/天）

---

## 🚀 推荐配置方案

### 生产环境推荐

**服务器配置**：
- **实例**：阿里云 ecs.gn6i-c4g1.xlarge 或 腾讯云 GN10Xp.XLARGE16
- **配置**：4核16GB，NVIDIA T4/P100 (16GB显存)
- **存储**：100GB SSD
- **带宽**：5-10Mbps
- **成本**：¥800-1000/月

**软件配置**：
- **方案**：云端API配置（chat_with_openai_compatible_bailian_cosyvoice.yaml）
- **ASR**：SenseVoice（云端API）
- **LLM**：DeepSeek API（您已有）
- **TTS**：CosyVoice API（百炼）
- **Avatar**：LiteAvatar（GPU渲染）

**总成本**：¥800-1000（服务器）+ ¥360（API） = **¥1160-1360/月**

### 开发/测试环境推荐

**服务器配置**：
- **实例**：阿里云 ecs.c7.2xlarge（CPU实例）
- **配置**：8核32GB，无GPU
- **存储**：50GB SSD
- **带宽**：5Mbps
- **成本**：¥400-600/月

**软件配置**：
- **方案**：CPU模式 + 云端API
- **Avatar**：LiteAvatar（CPU模式，性能较低）

**总成本**：¥400-600/月

---

## 📋 部署检查清单

### 服务器准备
- [ ] Ubuntu 22.04 LTS 已安装
- [ ] Python 3.11.7-3.11.14 已安装
- [ ] NVIDIA驱动 >= 535 已安装（GPU服务器）
- [ ] CUDA 12.4+ 已安装（GPU服务器）
- [ ] Docker 和 NVIDIA Container Toolkit 已安装
- [ ] Git LFS 已安装

### 网络配置
- [ ] 公网IP已配置
- [ ] 防火墙端口已开放（8282 HTTPS）
- [ ] TURN服务器已配置（如需NAT穿透）
- [ ] SSL证书已准备（localhost.crt/key 或正式证书）

### 应用配置
- [ ] OpenAvatarChat项目已克隆
- [ ] Git submodule已更新
- [ ] 配置文件已修改（API Key等）
- [ ] 模型已下载（如需要）
- [ ] 环境变量已配置（.env文件）

### 测试验证
- [ ] Docker容器可以正常启动
- [ ] GPU可以正常使用（nvidia-smi）
- [ ] Web界面可以访问（https://your-server:8282）
- [ ] RTC连接可以建立
- [ ] 语音识别正常
- [ ] TTS合成正常
- [ ] 数字人渲染正常

---

## 🔍 常见问题

### Q1: 没有GPU可以运行吗？
**A**: 可以，但性能会受影响。LiteAvatar在CPU模式下约为15-20 FPS（vs GPU 25-30 FPS），延迟会增加0.5-1秒。

### Q2: 最低配置是什么？
**A**: 最低配置（CPU模式）：
- CPU: 8核
- 内存: 16GB
- 存储: 50GB SSD
- 成本: ¥300-500/月

### Q3: 推荐哪个云服务商？
**A**: 
- **阿里云**：国内访问快，GPU实例丰富
- **腾讯云**：性价比高，GPU实例稳定
- **AWS**：国际化，但国内访问较慢

### Q4: 需要多少带宽？
**A**: 
- **最低**：5Mbps（单路）
- **推荐**：10-20Mbps（2-3路并发）
- **高并发**：50Mbps+（5路以上）

### Q5: 存储空间需要多少？
**A**: 
- **基础**：50GB（不下载模型，使用API）
- **推荐**：100GB（下载LiteAvatar模型）
- **完整**：200GB+（下载所有模型）

---

## 📚 参考资源

- [OpenAvatarChat GitHub](https://github.com/HumanAIGC-Engineering/OpenAvatarChat)
- [阿里云GPU实例](https://ecs.console.aliyun.com/)
- [腾讯云GPU实例](https://cloud.tencent.com/product/gpu)
- [CUDA安装指南](https://docs.nvidia.com/cuda/cuda-installation-guide-linux/)

---

**总结**：推荐使用**云端API配置方案**，服务器选择**4核16GB + NVIDIA T4/P100（16GB显存）**，总成本约**¥1160-1360/月**。

