# ✅ 正确的环境变量配置

## 🔑 阿里云配置的正确变量名

### ❌ 错误的配置（不会生效）

```bash
# 这些变量名是错误的！
ALIYUN_ACCESS_KEY_ID=xxx
ALIYUN_ACCESS_KEY_SECRET=xxx
ALIYUN_TTS_APP_KEY=xxx
```

### ✅ 正确的配置

```bash
# 阿里云 TTS（语音合成）- 正确的变量名
ALIYUN_TTS_ACCESS_KEY_ID=LTAI5txxxxxxxxxxxxxxxxxx
ALIYUN_TTS_ACCESS_KEY_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ALIYUN_TTS_REGION=cn-shanghai
ALIYUN_TTS_VOICE=siqi
ALIYUN_TTS_FORMAT=mp3
ALIYUN_TTS_SAMPLE_RATE=16000
```

**注意**: 变量名必须带 `TTS_` 前缀！

---

## 📋 完整的 .env 配置示例

在 `backend-api/.env` 文件中：

```bash
# ============================================================================
# AI 数字人面试系统 - 正确的环境配置
# ============================================================================

# ----------------------------------------------------------------------------
# DeepSeek AI（必需）
# ----------------------------------------------------------------------------
DEEPSEEK_API_KEY="<your-deepseek-api-key>"
DEEPSEEK_API_URL=https://api.deepseek.com/v1/chat/completions
DEEPSEEK_MODEL=deepseek-chat

# ----------------------------------------------------------------------------
# 火山引擎 ASR（语音识别）
# ----------------------------------------------------------------------------
VOLC_APP_ID=1234567890
VOLC_ACCESS_KEY=AKLTxxxxxxxxxxxxxxxx
VOLC_SECRET_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ----------------------------------------------------------------------------
# 阿里云 TTS（语音合成）- 注意变量名带 TTS_ 前缀！
# ----------------------------------------------------------------------------
ALIYUN_TTS_ACCESS_KEY_ID=LTAI5txxxxxxxxxxxxxxxxxx
ALIYUN_TTS_ACCESS_KEY_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ALIYUN_TTS_REGION=cn-shanghai
ALIYUN_TTS_VOICE=siqi
ALIYUN_TTS_FORMAT=mp3
ALIYUN_TTS_SAMPLE_RATE=16000

# ----------------------------------------------------------------------------
# 其他配置
# ----------------------------------------------------------------------------
NODE_ENV=development
PORT=3001
TTS_PROVIDER=aliyun
AUDIO_UPLOAD_DIR=uploads/audio
CORS_ORIGIN=http://localhost:3000,http://localhost:5173,http://localhost:8080

# ----------------------------------------------------------------------------
# 可选：阿里云 OSS（如需存储音频文件到OSS）
# ----------------------------------------------------------------------------
# OSS_ACCESS_KEY_ID=LTAI5txxxxxxxxxxxxxxxxxx
# OSS_ACCESS_KEY_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# OSS_REGION=oss-cn-beijing
# OSS_BUCKET=your-bucket-name

# ----------------------------------------------------------------------------
# 可选：数据库
# ----------------------------------------------------------------------------
# DATABASE_URL="postgresql://user:password@localhost:5432/ai_interview"
```

---

## 🔍 为什么要带 TTS_ 前缀？

系统中可能同时使用多个阿里云服务：
- **TTS（语音合成）**: `ALIYUN_TTS_*`
- **OSS（对象存储）**: `OSS_*` 或 `ALIYUN_OSS_*`
- **SMS（短信服务）**: `ALIYUN_SMS_*`

为了避免混淆，每个服务使用独立的前缀。

---

## 🛠️ 如何修改你的配置

### 步骤 1: 打开配置文件

```bash
cd backend-api
vi .env
```

### 步骤 2: 修改变量名

将：
```bash
ALIYUN_ACCESS_KEY_ID=xxx
ALIYUN_ACCESS_KEY_SECRET=xxx
```

改为：
```bash
ALIYUN_TTS_ACCESS_KEY_ID=xxx
ALIYUN_TTS_ACCESS_KEY_SECRET=xxx
```

### 步骤 3: 保存并退出

按 `Esc`，输入 `:wq`，回车

---

## ✅ 验证配置

### 方法 1: 运行检查脚本

```bash
cd ..
./check-digital-human-config.sh
```

应该看到：
```
✓ 阿里云 TTS: 已配置阿里云 TTS
```

### 方法 2: 手动验证

```bash
cd backend-api
source .env
echo "TTS Key ID: ${ALIYUN_TTS_ACCESS_KEY_ID:0:10}..."
```

如果显示密钥前10位，说明配置正确。

---

## 🎯 其他服务的正确变量名

### Azure TTS（备选）

```bash
AZURE_TTS_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
AZURE_TTS_REGION=eastasia
AZURE_TTS_VOICE=zh-CN-XiaoxiaoNeural
```

**注意**: Azure 的变量名也是 `AZURE_TTS_*`，不是 `AZURE_SPEECH_*`

### 火山引擎 ASR

```bash
VOLC_APP_ID=1234567890
VOLC_ACCESS_KEY=AKLTxxxxxxxxxxxxxxxx
VOLC_SECRET_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

变量名没有前缀，这个是正确的。

### 声网 ASR（备选）

```bash
AGORA_APP_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
AGORA_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
AGORA_API_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

## 🚀 配置完成后

```bash
# 1. 重新检查配置
./check-digital-human-config.sh

# 2. 启动系统
./start-digital-human-test.sh

# 3. 应该看到
✅ TTS服务已配置 (aliyun)，将使用真实服务
```

---

## 💡 快速修改命令

如果你已经有配置文件，可以用这个命令快速修改：

```bash
cd backend-api

# 备份原文件
cp .env .env.backup

# 修改变量名
sed -i '' 's/^ALIYUN_ACCESS_KEY_ID=/ALIYUN_TTS_ACCESS_KEY_ID=/' .env
sed -i '' 's/^ALIYUN_ACCESS_KEY_SECRET=/ALIYUN_TTS_ACCESS_KEY_SECRET=/' .env
sed -i '' 's/^AZURE_SPEECH_KEY=/AZURE_TTS_KEY=/' .env
sed -i '' 's/^AZURE_SPEECH_REGION=/AZURE_TTS_REGION=/' .env

echo "✅ 变量名已修改！"

# 验证
source .env
echo "TTS Key: ${ALIYUN_TTS_ACCESS_KEY_ID:0:10}..."
```

---

## 📝 总结

| 服务 | ❌ 错误变量名 | ✅ 正确变量名 |
|------|--------------|--------------|
| 阿里云 TTS | `ALIYUN_ACCESS_KEY_ID` | `ALIYUN_TTS_ACCESS_KEY_ID` |
| 阿里云 TTS | `ALIYUN_ACCESS_KEY_SECRET` | `ALIYUN_TTS_ACCESS_KEY_SECRET` |
| Azure TTS | `AZURE_SPEECH_KEY` | `AZURE_TTS_KEY` |
| Azure TTS | `AZURE_SPEECH_REGION` | `AZURE_TTS_REGION` |

**记住**: TTS 相关的变量都要带 `TTS_` 前缀！

