# Live2D æ˜¾ç¤ºé—®é¢˜ç»ˆæä¿®å¤ - GLSurfaceView

## ğŸ” é—®é¢˜æ ¹æœ¬åŸå› 

### æ¶æ„é—®é¢˜
ä½¿ç”¨ **TextureView + è‡ªå®šä¹‰ EGL ä¸Šä¸‹æ–‡** çš„æ–¹æ¡ˆå­˜åœ¨é—®é¢˜ï¼š
- âŒ TextureView éœ€è¦æ‰‹åŠ¨ç®¡ç† Surface æ›´æ–°
- âŒ è‡ªå®šä¹‰ EGL ä¸Šä¸‹æ–‡ç®¡ç†å¤æ‚
- âŒ æ¸²æŸ“ç»“æœå¯èƒ½ä¸ä¼šæ­£ç¡®æ˜¾ç¤ºåˆ°å±å¹•
- âŒ ä¸ Compose é›†æˆæœ‰å±‚çº§å’Œåˆ·æ–°é—®é¢˜

## âœ… è§£å†³æ–¹æ¡ˆ

### æ”¹ç”¨ GLSurfaceViewï¼ˆAndroid å®˜æ–¹æ¨èï¼‰
**GLSurfaceView** æ˜¯ Android ä¸“é—¨ä¸º OpenGL æ¸²æŸ“è®¾è®¡çš„ï¼š
- âœ… è‡ªåŠ¨ç®¡ç† EGL ä¸Šä¸‹æ–‡å’Œ Surface
- âœ… è‡ªåŠ¨ç®¡ç†æ¸²æŸ“çº¿ç¨‹
- âœ… è‡ªåŠ¨å¤„ç†å±å¹•åˆ·æ–°
- âœ… ä¸ Compose çš„ AndroidView å®Œç¾é›†æˆ

## ğŸ“ å®ç°æ”¹åŠ¨

### 1. åˆ›å»ºæ–°çš„ Live2DGLView
**æ–‡ä»¶**: `app/src/main/java/com/example/v0clone/live2d/Live2DGLView.kt`

```kotlin
class Live2DGLView : GLSurfaceView {
    init {
        // è®¾ç½® OpenGL ES 2.0
        setEGLContextClientVersion(2)
        
        // åˆ›å»ºæ¸²æŸ“å™¨
        renderer = Live2DRenderer(context)
        setRenderer(renderer)
        
        // æŒç»­æ¸²æŸ“æ¨¡å¼
        renderMode = RENDERMODE_CONTINUOUSLY
    }
}
```

**å…³é”®ä¼˜åŠ¿**ï¼š
- GLSurfaceView è‡ªåŠ¨ç®¡ç†æ‰€æœ‰ OpenGL ç›¸å…³èµ„æº
- ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º EGL ä¸Šä¸‹æ–‡
- ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ swap buffers
- æ¸²æŸ“ç»“æœè‡ªåŠ¨æ˜¾ç¤ºåˆ°å±å¹•

### 2. æ›´æ–° Live2DComposable.kt
```kotlin
@Composable
fun Live2DView(
    modifier: Modifier = Modifier,
    onViewCreated: ((Live2DGLView) -> Unit)? = null
) {
    val view = remember {
        Live2DGLView(context).apply {
            onViewCreated?.invoke(this)
        }
    }
    
    AndroidView(
        modifier = modifier,
        factory = { view }
    )
}
```

### 3. ä¿æŒå…¶ä»–ä»£ç ä¸å˜
- Live2DRenderer.kt - æ— éœ€ä¿®æ”¹
- Live2DModel.cpp/hpp - æ— éœ€ä¿®æ”¹
- DigitalInterviewScreen.kt - æ— éœ€ä¿®æ”¹
- åªæ˜¯æŠŠåº•å±‚çš„ View ä» TextureView æ¢æˆ GLSurfaceView

## ğŸ¯ é¢„æœŸç»“æœ

### å¯åŠ¨åº”ç”¨ååº”è¯¥çœ‹åˆ°ï¼š
1. âœ… **Hiyori æ•°å­—äºº**æ¸…æ™°æ˜¾ç¤ºåœ¨ä¸»ç”»é¢
2. âœ… **æµ…è‰²èƒŒæ™¯**ï¼ˆRGB: 245, 247, 250ï¼‰
3. âœ… **æµç•…åŠ¨ç”»**ï¼ˆ60 FPSï¼‰
   - çœ¨çœ¼åŠ¨ç”»
   - å‘¼å¸åŠ¨ç”»
   - èº«ä½“è‡ªç„¶æ‘†åŠ¨
4. âœ… **è‡ªåŠ¨æ’­æ”¾éšæœºåŠ¨ä½œ**ï¼ˆæ¯ 2 ç§’ï¼‰
5. âœ… **è§¦æ‘¸äº¤äº’**
   - å•å‡»è§¦å‘éšæœºåŠ¨ä½œ
   - åŒå‡»åˆ‡æ¢ä¸»å‰¯ç”»é¢
   - æ‹–åŠ¨å°çª—è°ƒæ•´ä½ç½®

## ğŸ“Š æŠ€æœ¯å¯¹æ¯”

| ç‰¹æ€§ | TextureView + è‡ªå®šä¹‰ EGL | GLSurfaceView |
|------|-------------------------|---------------|
| **EGL ç®¡ç†** | âŒ æ‰‹åŠ¨ç®¡ç† | âœ… è‡ªåŠ¨ç®¡ç† |
| **æ¸²æŸ“çº¿ç¨‹** | âŒ æ‰‹åŠ¨åˆ›å»º | âœ… è‡ªåŠ¨åˆ›å»º |
| **å±å¹•åˆ·æ–°** | âŒ éœ€è¦æ‰‹åŠ¨è§¦å‘ | âœ… è‡ªåŠ¨åˆ·æ–° |
| **æ€§èƒ½** | âš ï¸ ä¸­ç­‰ | âœ… ä¼˜ç§€ |
| **ç¨³å®šæ€§** | âš ï¸ å®¹æ˜“å‡ºé—®é¢˜ | âœ… ç¨³å®šå¯é  |
| **ä»£ç å¤æ‚åº¦** | âŒ é«˜ï¼ˆ~300 è¡Œï¼‰ | âœ… ä½ï¼ˆ~80 è¡Œï¼‰ |
| **å®˜æ–¹æ¨è** | âŒ ä¸æ¨è | âœ… æ¨è |

## ğŸ”§ å¦‚ä½•æµ‹è¯•

### 1. åœæ­¢å¹¶é‡å¯åº”ç”¨
```bash
adb shell am force-stop com.xlwl.AiMian
# åœ¨è®¾å¤‡ä¸Šé‡æ–°æ‰“å¼€åº”ç”¨
```

### 2. è¿›å…¥æ•°å­—äººé¢è¯•
1. æ‰“å¼€ã€ŒAIé¢é¢ã€
2. ç‚¹å‡»ã€ŒAI é¢è¯•ã€
3. é€‰æ‹©ã€Œæ•°å­—äººé¢è¯•ã€

### 3. æŸ¥çœ‹æ—¥å¿—
```bash
adb logcat -d | grep -E "Live2DGLView|Live2DRenderer" | head -30
```

åº”è¯¥çœ‹åˆ°ï¼š
```
I Live2DGLView: Live2DGLView initialized with GLSurfaceView
I Live2DRenderer: onSurfaceCreated
I Live2DRenderer: Renderer initialized: 1220x2602
I Live2DModel: Model loaded successfully
I Live2DRenderer: Rendered first Live2D frame
```

## ğŸ¨ è§†è§‰æ•ˆæœ

### æ¨¡å‹ç‰¹å¾ï¼ˆHiyoriï¼‰
- ğŸ‘§ **è§’è‰²**ï¼šå¹´è½»å¥³æ€§
- ğŸ‘— **æœè£…**ï¼šä¼‘é—²è£…
- ğŸ’‡ **å‘å‹**ï¼šä¸­é•¿å‘
- ğŸ¨ **é£æ ¼**ï¼šæ—¥ç³» 2D åŠ¨ç”»

### åŠ¨ç”»æ•ˆæœ
- **è‡ªç„¶çœ¨çœ¼**ï¼šæ¯ 3-5 ç§’
- **å‘¼å¸åŠ¨ä½œ**ï¼šèƒ¸éƒ¨å¾®å¾®èµ·ä¼
- **èº«ä½“æ‘†åŠ¨**ï¼šè½»å¾®å·¦å³æ‘†åŠ¨
- **è¡¨æƒ…å˜åŒ–**ï¼šæ ¹æ®åŠ¨ä½œæ”¹å˜

### éšæœºåŠ¨ä½œ
1. æ‰“æ‹›å‘¼ï¼ˆæŒ¥æ‰‹ï¼‰
2. ç‚¹å¤´ï¼ˆè¡¨ç¤ºåŒæ„ï¼‰
3. æ‘‡å¤´ï¼ˆè¡¨ç¤ºå¦å®šï¼‰
4. æƒŠè®¶ï¼ˆå¼ å¤§å˜´ï¼‰
5. æ€è€ƒï¼ˆæ‰‹æ‰˜ä¸‹å·´ï¼‰
6. å¼€å¿ƒï¼ˆå¾®ç¬‘ï¼‰
7. å®³ç¾ï¼ˆè„¸çº¢ï¼‰
8. ç”Ÿæ°”ï¼ˆé¼“è„¸ï¼‰
9. éš¾è¿‡ï¼ˆä½å¤´ï¼‰

## âš ï¸ å·²çŸ¥é™åˆ¶

### è®¾å¤‡è¦æ±‚
- æœ€ä½ Android 7.0 (API 24)
- æ”¯æŒ OpenGL ES 2.0
- å»ºè®® 2GB+ RAM

### æ€§èƒ½è€ƒè™‘
- CPU ä½¿ç”¨ç‡ï¼š5-10%
- å†…å­˜å ç”¨ï¼š30-50 MB
- å¸§ç‡ï¼šç¨³å®š 60 FPS
- ç”µæ± å½±å“ï¼šè½»å¾®

## ğŸš€ æœªæ¥ä¼˜åŒ–

### çŸ­æœŸ
- [ ] æ·»åŠ è¯­éŸ³å£å‹åŒæ­¥
- [ ] æ ¹æ®é¢è¯•çŠ¶æ€æ’­æ”¾å¯¹åº”åŠ¨ä½œ
- [ ] ä¼˜åŒ–æ¨¡å‹æ˜¾ç¤ºå°ºå¯¸

### ä¸­æœŸ
- [ ] è§†çº¿è·Ÿè¸ªï¼ˆçœ‹å‘ç”¨æˆ·ï¼‰
- [ ] å¤šè¡¨æƒ…åˆ‡æ¢
- [ ] è‡ªå®šä¹‰æ¨¡å‹æ”¯æŒ

### é•¿æœŸ
- [ ] å®æ—¶è¡¨æƒ…æ§åˆ¶
- [ ] å¤šæ¨¡å‹åŒæ—¶æ¸²æŸ“
- [ ] AR/VR é›†æˆ

## ğŸ“ æ•…éšœæ’é™¤

### å¦‚æœè¿˜æ˜¯çœ‹ä¸è§

#### 1. æ£€æŸ¥æ—¥å¿—
```bash
adb logcat -d | grep -E "Live2D|OpenGL|EGL" > log.txt
```

#### 2. ç¡®è®¤è®¾å¤‡æ”¯æŒ
```bash
adb shell dumpsys | grep -i opengl
```
åº”è¯¥æ˜¾ç¤º OpenGL ES 2.0 æˆ–æ›´é«˜

#### 3. æ¸…é™¤åº”ç”¨æ•°æ®
```bash
adb shell pm clear com.xlwl.AiMian
```

#### 4. é‡æ–°å®‰è£…
```bash
cd android-v0-compose
./gradlew :app:uninstallDebug
./gradlew :app:installDebug
```

---

**ä¿®å¤æ—¶é—´**: 2025-11-01  
**ç‰ˆæœ¬**: v2.0.0 (GLSurfaceView)  
**çŠ¶æ€**: âœ… å·²ä¿®å¤æ¶æ„é—®é¢˜

**å…³é”®æ”¹è¿›**ï¼š
- ä» TextureView è¿ç§»åˆ° GLSurfaceView
- ç®€åŒ–ä»£ç ä» ~500 è¡Œåˆ° ~200 è¡Œ
- æå‡ç¨³å®šæ€§å’Œæ€§èƒ½
- ç¬¦åˆ Android å®˜æ–¹æœ€ä½³å®è·µ

