# ğŸš€ æ•°å­—äººæ²Ÿé€šå®Œæ•´æµ‹è¯•æµç¨‹

> ä»é›¶å¼€å§‹ï¼Œå®Œæ•´æµ‹è¯•æ•°å­—äººå¯¹è¯åŠŸèƒ½

---

## ğŸ“‹ å½“å‰çŠ¶æ€

- âœ… åç«¯æœåŠ¡è¿è¡Œä¸­ï¼ˆç«¯å£ 3001ï¼‰
- âœ… DeepSeek API å·²é…ç½®
- âœ… é˜¿é‡Œäº‘ TTS å·²é…ç½®
- âš ï¸ ASR æœªé…ç½®ï¼ˆä½¿ç”¨æ–‡æœ¬è¾“å…¥æ¨¡å¼ï¼‰
- âœ… APP èƒ½è¿æ¥åˆ°æœåŠ¡å™¨

---

## ğŸ¯ æµ‹è¯•ç›®æ ‡

å®Œæˆä¸€ä¸ªå®Œæ•´çš„å¯¹è¯æµç¨‹ï¼š
```
ç”¨æˆ·è¾“å…¥æ–‡æœ¬ â†’ DeepSeek ç”Ÿæˆå›å¤ â†’ TTS åˆæˆè¯­éŸ³ â†’ è¿”å›éŸ³é¢‘ â†’ æ’­æ”¾
```

---

## ğŸ› ï¸ ç¬¬ä¸€æ­¥ï¼šé‡å¯åç«¯æœåŠ¡

```bash
# 1. åœæ­¢æ—§æœåŠ¡
cd /Users/linxiong/Documents/dev/AI-Interview-System/backend-api
pkill -f "ts-node src/index.ts" || true

# 2. é‡æ–°å¯åŠ¨
npm run dev
```

**åº”è¯¥çœ‹åˆ°**ï¼š
```
âœ… TTSæœåŠ¡å·²é…ç½® (aliyun)
âœ… DeepSeekæœåŠ¡å·²åˆå§‹åŒ–
ğŸš€ Server started on http://localhost:3001
```

---

## ğŸ§ª ç¬¬äºŒæ­¥ï¼šæµ‹è¯• HTTP æ¥å£

### æ–¹æ³• 1ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
cd /Users/linxiong/Documents/dev/AI-Interview-System/backend-api
./test-digital-human.sh
```

**æˆåŠŸçš„è¯ä¼šè¿”å›**ï¼š
```json
{
  "success": true,
  "text": "ä½ å¥½ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ...",
  "audioUrl": "http://localhost:3001/uploads/audio/xxxxx.mp3",
  "sessionId": "test-12345",
  "timestamp": "2024-11-02T12:00:00.000Z"
}
```

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨ curl æµ‹è¯•

```bash
curl -X POST http://192.168.120.124:3001/api/digital-human/chat \
  -H "Content-Type: application/json" \
  -d '{
    "sessionId": "test-123",
    "text": "ä½ å¥½",
    "userId": "test-user"
  }'
```

---

## ğŸ“± ç¬¬ä¸‰æ­¥ï¼šåœ¨æ‰‹æœºä¸Šæµ‹è¯•

### æµ‹è¯• 1ï¼šæµè§ˆå™¨æµ‹è¯• HTTP æ¥å£

åœ¨æ‰‹æœºæµè§ˆå™¨æ‰“å¼€è°ƒè¯•å·¥å…·ï¼ˆæˆ–ç”¨ Postman ç±» APPï¼‰ï¼Œè®¿é—®ï¼š

```
POST http://192.168.120.124:3001/api/digital-human/chat

Body (JSON):
{
  "sessionId": "mobile-test",
  "text": "ä½ å¥½",
  "userId": "test"
}
```

### æµ‹è¯• 2ï¼šåœ¨ APP ä¸­æµ‹è¯•

å¦‚æœ HTTP æ¥å£æ­£å¸¸ï¼Œæˆ‘ä»¬å°±çŸ¥é“ï¼š
- âœ… ç½‘ç»œé€š
- âœ… DeepSeek æ­£å¸¸
- âœ… TTS æ­£å¸¸

é‚£ä¹ˆé—®é¢˜å°±åªåœ¨ WebSocket è¿æ¥ä¸Šã€‚

---

## ğŸ”Œ ç¬¬å››æ­¥ï¼šæ£€æŸ¥ WebSocket æœåŠ¡

### æŸ¥çœ‹ WebSocket æ˜¯å¦å¯åŠ¨

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—ï¼Œåº”è¯¥æœ‰è¿™è¡Œ
grep "WebSocket" backend-api/digital-human-backend.log
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… å®æ—¶è¯­éŸ³WebSocketæœåŠ¡å·²å¯åŠ¨
```

### æµ‹è¯• WebSocket è¿æ¥

```bash
# å®‰è£… wscatï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
npm install -g wscat

# æµ‹è¯•è¿æ¥
wscat -c ws://192.168.120.124:3001
```

**è¿æ¥æˆåŠŸä¼šæ˜¾ç¤º**ï¼š
```
Connected (press CTRL+C to quit)
>
```

ç„¶åå‘é€æµ‹è¯•æ¶ˆæ¯ï¼š
```json
{"type":"init_session","sessionId":"test-123","userId":"test"}
```

---

## ğŸ¯ ç¬¬äº”æ­¥ï¼šå®šä½ APP é—®é¢˜

å¦‚æœä¸Šé¢çš„æµ‹è¯•éƒ½æ­£å¸¸ï¼Œè¯´æ˜åç«¯å®Œå…¨ OKï¼Œé—®é¢˜åœ¨ APP çš„ WebSocket å®¢æˆ·ç«¯ã€‚

### æ£€æŸ¥ APP WebSocket åˆå§‹åŒ–

åœ¨ Android ä»£ç ä¸­ï¼ŒWebSocket åˆå§‹åŒ–éœ€è¦ï¼š

1. **åˆ›å»º Socket.IO å®¢æˆ·ç«¯**
2. **è¿æ¥åˆ°æœåŠ¡å™¨**
3. **å‘é€ init_session äº‹ä»¶**
4. **ç›‘å¬ voice_response äº‹ä»¶**

### æŸ¥çœ‹ APP æ—¥å¿—

```bash
# æŸ¥çœ‹ WebSocket ç›¸å…³æ—¥å¿—
adb logcat | grep -i "socket\|websocket\|connect"
```

åº”è¯¥çœ‹åˆ°ï¼š
```
I Socket.IO: Connecting to ws://192.168.120.124:3001
I Socket.IO: Connected successfully
I Socket.IO: Emitting init_session
```

**å¦‚æœæ²¡æœ‰è¿™äº›æ—¥å¿—ï¼Œè¯´æ˜ Socket.IO å®¢æˆ·ç«¯æ²¡æœ‰åˆå§‹åŒ–ï¼**

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šHTTP æ¥å£æ­£å¸¸ï¼Œä½† WebSocket è¿æ¥å¤±è´¥

**åŸå› **ï¼šWebSocket éœ€è¦ä¸åŒçš„é…ç½®

**è§£å†³**ï¼šæ£€æŸ¥ APP ä¸­çš„ Socket.IO é…ç½®ï¼š

```kotlin
// åº”è¯¥æ˜¯
val socket = IO.socket("http://192.168.120.124:3001", options)

// ä¸æ˜¯
val socket = IO.socket("ws://192.168.120.124:3001", options)
```

**æ³¨æ„**ï¼šSocket.IO ä½¿ç”¨ HTTP/HTTPSï¼Œä¸æ˜¯ WS/WSSï¼

### é—®é¢˜ 2ï¼šAPP æ˜¾ç¤º"è¿æ¥ä¸­"ä½†æ²¡æœ‰æ—¥å¿—

**åŸå› **ï¼šRealtimeVoiceManager çš„ initialize æ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨

**æœ€å¯èƒ½çš„åŸå› **ï¼š
- `sessionId` ä¸ºç©º
- æƒé™æ£€æŸ¥å¤±è´¥
- LaunchedEffect çš„æ¡ä»¶ä¸æ»¡è¶³

**å¿«é€ŸéªŒè¯**ï¼š
```bash
# æŸ¥çœ‹ UI çŠ¶æ€æ—¥å¿—
adb logcat | grep "UI State"
```

å¦‚æœçœ‹åˆ° `sessionId=''` æˆ– `sessionId=null`ï¼Œé‚£å°±æ˜¯é—®é¢˜ï¼

### é—®é¢˜ 3ï¼šæ‰¾ä¸åˆ° sessionId

**åŸå› **ï¼šæ•°å­—äººç•Œé¢å¯èƒ½éœ€è¦ä»å¯¼èˆªå‚æ•°æˆ– ViewModel è·å– sessionId

**è§£å†³**ï¼šæ£€æŸ¥å¦‚ä½•è¿›å…¥æ•°å­—äººç•Œé¢ï¼š
- ä»é¢è¯•åˆ—è¡¨è¿›å…¥ï¼Ÿ
- éœ€è¦å…ˆåˆ›å»ºé¢è¯•ï¼Ÿ
- sessionId ä»å“ªé‡Œæ¥ï¼Ÿ

---

## ğŸ’¡ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨å›ºå®š sessionId æµ‹è¯•

åœ¨ APP ä»£ç ä¸­ä¸´æ—¶ç¡¬ç¼–ç ï¼š

```kotlin
// ä¸´æ—¶æµ‹è¯•ç”¨
val testSessionId = "test-session-${System.currentTimeMillis()}"

LaunchedEffect(testSessionId, hasMicrophonePermission) {
    if (testSessionId.isNotBlank() && hasMicrophonePermission) {
        voiceManager.initialize(
            "http://192.168.120.124:3001",  // æ³¨æ„ï¼šHTTP ä¸æ˜¯ WS
            testSessionId,
            jobPosition = "è½¯ä»¶å·¥ç¨‹å¸ˆ"
        )
    }
}
```

### æ–¹æ¡ˆ 2ï¼šæ·»åŠ æ—¥å¿—çœ‹åˆ°åº•æ‰§è¡Œåˆ°å“ªé‡Œ

```kotlin
Log.d("TEST", "1. DigitalInterviewScreen å¼€å§‹æ¸²æŸ“")
Log.d("TEST", "2. sessionId = ${uiState.sessionId}")
Log.d("TEST", "3. hasMicrophonePermission = $hasMicrophonePermission")
Log.d("TEST", "4. å‡†å¤‡è°ƒç”¨ initialize...")

voiceManager.initialize(...)

Log.d("TEST", "5. initialize è°ƒç”¨å®Œæˆ")
```

ç„¶åï¼š
```bash
adb logcat | grep "TEST"
```

çœ‹åˆ°åº•æ‰§è¡Œåˆ°ç¬¬å‡ æ­¥ã€‚

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œï¼š

1. **é‡å¯åç«¯**ï¼ˆåŠ è½½æ–°çš„è·¯ç”±ï¼‰
   ```bash
   cd backend-api
   npm run dev
   ```

2. **æµ‹è¯• HTTP æ¥å£**
   ```bash
   ./test-digital-human.sh
   ```

3. **å¦‚æœ HTTP æ¥å£æ­£å¸¸**ï¼Œé—®é¢˜å°±åœ¨ WebSocket æˆ– APP åˆå§‹åŒ–
   
4. **æŸ¥çœ‹ APP æ—¥å¿—**
   ```bash
   adb logcat | grep -i "socket"
   ```

---

## ğŸ“ éœ€è¦æˆ‘çš„å¸®åŠ©

æŠŠä»¥ä¸‹ä¿¡æ¯å‘ç»™æˆ‘ï¼š

1. **HTTP æ¥å£æµ‹è¯•ç»“æœ**
   ```bash
   cd backend-api
   ./test-digital-human.sh
   ```

2. **WebSocket æ˜¯å¦å¯åŠ¨**
   ```bash
   grep "WebSocket" logs/*.log
   ```

3. **APP æ—¥å¿—ä¸­æœ‰æ²¡æœ‰ Socket.IO ç›¸å…³çš„æ—¥å¿—**
   ```bash
   adb logcat | grep -i "socket" | head -20
   ```

æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œæˆ‘èƒ½ç²¾å‡†å®šä½å¹¶è§£å†³é—®é¢˜ï¼

---

**å…ˆæµ‹è¯• HTTP æ¥å£ï¼Œå¦‚æœæ­£å¸¸ï¼Œæˆ‘ä»¬å°±çŸ¥é“åç«¯å®Œå…¨ OKï¼Œç„¶åä¸“æ³¨è§£å†³ WebSocket è¿æ¥é—®é¢˜ï¼** ğŸ¯

