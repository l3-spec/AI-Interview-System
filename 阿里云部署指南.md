# AIé¢è¯•ç³»ç»Ÿ - é˜¿é‡Œäº‘éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•å°†AIé¢è¯•ç³»ç»Ÿéƒ¨ç½²åˆ°é˜¿é‡Œäº‘å¹³å°ã€‚

## ðŸ—ï¸ æž¶æž„æ¦‚è§ˆ

```
é˜¿é‡Œäº‘æž¶æž„
â”œâ”€â”€ ECS (äº‘æœåŠ¡å™¨)              # åº”ç”¨æœåŠ¡
â”œâ”€â”€ RDS MySQL (äº‘æ•°æ®åº“)        # æ•°æ®å­˜å‚¨
â”œâ”€â”€ Redis (äº‘æ•°æ®åº“)           # ç¼“å­˜æœåŠ¡
â”œâ”€â”€ OSS (å¯¹è±¡å­˜å‚¨)             # æ–‡ä»¶å­˜å‚¨
â”œâ”€â”€ SLB (è´Ÿè½½å‡è¡¡)             # è´Ÿè½½å‡è¡¡
â”œâ”€â”€ CDN (å†…å®¹åˆ†å‘)             # é™æ€èµ„æºåŠ é€Ÿ
â””â”€â”€ é‚®ä»¶æŽ¨é€æœåŠ¡               # é‚®ä»¶å‘é€
```

## ðŸ“‹ å‰ç½®å‡†å¤‡

### 1. é˜¿é‡Œäº‘è´¦å·
- æ³¨å†Œé˜¿é‡Œäº‘è´¦å·
- å®Œæˆå®žåè®¤è¯
- å¼€é€šæ‰€éœ€æœåŠ¡

### 2. åŸŸåå¤‡æ¡ˆ
- è´­ä¹°åŸŸå
- å®ŒæˆICPå¤‡æ¡ˆ
- é…ç½®DNSè§£æž

## ðŸ—„ï¸ æ•°æ®åº“æœåŠ¡

### 1. åˆ›å»ºRDS MySQLå®žä¾‹

```bash
# é…ç½®å‚æ•°
å®žä¾‹è§„æ ¼: è‡³å°‘ 2æ ¸4GB
å­˜å‚¨ç©ºé—´: 100GBèµ·
MySQLç‰ˆæœ¬: 8.0
å¯ç”¨åŒº: é€‰æ‹©ä¸ŽECSç›¸åŒçš„å¯ç”¨åŒº
```

### 2. æ•°æ®åº“é…ç½®

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE ai_interview_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·ï¼ˆRDSæŽ§åˆ¶å°æ“ä½œï¼‰
-- ç”¨æˆ·å: ai_interview
-- å¯†ç : è®¾ç½®å¼ºå¯†ç 
```

### 3. è¿žæŽ¥ä¿¡æ¯

```bash
# èŽ·å–è¿žæŽ¥åœ°å€
å†…ç½‘åœ°å€: rm-xxxxxxxxxx.mysql.rds.aliyuncs.com
ç«¯å£: 3306
æ•°æ®åº“: ai_interview_db
```

## ðŸ”´ Redisç¼“å­˜æœåŠ¡

### 1. åˆ›å»ºRediså®žä¾‹

```bash
# é…ç½®å‚æ•°
å®žä¾‹è§„æ ¼: 1GBèµ·
Redisç‰ˆæœ¬: 6.0
ç½‘ç»œç±»åž‹: VPC
å¯ç”¨åŒº: ä¸ŽECSã€RDSä¿æŒä¸€è‡´
```

### 2. è¿žæŽ¥é…ç½®

```bash
# è¿žæŽ¥åœ°å€
å†…ç½‘åœ°å€: r-xxxxxxxxxx.redis.rds.aliyuncs.com
ç«¯å£: 6379
å¯†ç : è®¾ç½®è®¿é—®å¯†ç 
```

## ðŸ–¥ï¸ ECSäº‘æœåŠ¡å™¨

### 1. åˆ›å»ºECSå®žä¾‹

```bash
# æŽ¨èé…ç½®
CPU: 2æ ¸æˆ–ä»¥ä¸Š
å†…å­˜: 4GBæˆ–ä»¥ä¸Š
ç³»ç»Ÿç›˜: 40GB SSD
æ“ä½œç³»ç»Ÿ: Ubuntu 20.04 LTS
ç½‘ç»œ: VPCç½‘ç»œ
å®‰å…¨ç»„: å¼€æ”¾22, 80, 443, 3001ç«¯å£
```

### 2. çŽ¯å¢ƒå®‰è£…

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# å®‰è£…PM2
sudo npm install -g pm2

# å®‰è£…Nginx
sudo apt install nginx -y

# å®‰è£…Git
sudo apt install git -y
```

## ðŸ“¦ åº”ç”¨éƒ¨ç½²

### 1. ä»£ç éƒ¨ç½²

```bash
# å…‹éš†ä»£ç 
git clone https://github.com/your-repo/AI-Interview-System.git
cd AI-Interview-System

# åŽç«¯éƒ¨ç½²
cd backend-api
npm install --production
npm run build

# å‰ç«¯æž„å»º
cd ../admin-dashboard
npm install
npm run build
```

### 2. çŽ¯å¢ƒé…ç½®

```bash
# åŽç«¯çŽ¯å¢ƒå˜é‡
cd backend-api
cat > .env << EOF
# æ•°æ®åº“é…ç½®
DATABASE_URL="mysql://ai_interview:your-password@rm-xxxxxxxxxx.mysql.rds.aliyuncs.com:3306/ai_interview_db"

# Redisé…ç½®
REDIS_URL="redis://:your-redis-password@r-xxxxxxxxxx.redis.rds.aliyuncs.com:6379"

# JWTé…ç½®
JWT_SECRET="your-production-jwt-secret-very-long-and-secure"
JWT_EXPIRE="7d"

# æœåŠ¡å™¨é…ç½®
PORT=3001
NODE_ENV="production"

# é˜¿é‡Œäº‘é‚®ä»¶æŽ¨é€
SMTP_HOST="smtpdm.aliyun.com"
SMTP_PORT=25
SMTP_USER="your-account@your-domain.com"
SMTP_PASS="your-smtp-password"

# é˜¿é‡Œäº‘OSSé…ç½®
OSS_REGION="oss-cn-hangzhou"
OSS_ACCESS_KEY_ID="your-access-key-id"
OSS_ACCESS_KEY_SECRET="your-access-key-secret"
OSS_BUCKET="your-bucket-name"

# ç®¡ç†å‘˜é…ç½®
ADMIN_EMAIL="admin@yourdomain.com"
ADMIN_PASSWORD="your-admin-password"
EOF
```

### 3. æ•°æ®åº“è¿ç§»

```bash
# ç”ŸæˆPrismaå®¢æˆ·ç«¯
npx prisma generate

# è¿è¡Œæ•°æ®åº“è¿ç§»
npx prisma migrate deploy

# åˆ›å»ºåˆå§‹ç®¡ç†å‘˜ç”¨æˆ·
npx prisma db seed
```

### 4. PM2è¿›ç¨‹ç®¡ç†

```bash
# åˆ›å»ºPM2é…ç½®æ–‡ä»¶
cat > ecosystem.config.js << EOF
module.exports = {
  apps: [{
    name: 'ai-interview-api',
    script: 'dist/index.js',
    cwd: './backend-api',
    instances: 'max',
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3001
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true
  }]
};
EOF

# å¯åŠ¨åº”ç”¨
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

## ðŸŒ Nginxé…ç½®

### 1. åˆ›å»ºNginxé…ç½®

```bash
sudo cat > /etc/nginx/sites-available/ai-interview << EOF
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://\$server_name\$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;
    
    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/nginx/ssl/yourdomain.com.crt;
    ssl_certificate_key /etc/nginx/ssl/yourdomain.com.key;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/ai-interview-admin;
        try_files \$uri \$uri/ /index.html;
        
        # é™æ€èµ„æºç¼“å­˜
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # APIä»£ç†
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade \$http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
        proxy_cache_bypass \$http_upgrade;
    }
    
    # æ–‡ä»¶ä¸Šä¼ 
    location /uploads {
        proxy_pass http://localhost:3001;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
    }
}
EOF

# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/ai-interview /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 2. SSLè¯ä¹¦é…ç½®

```bash
# ä½¿ç”¨å…è´¹SSLè¯ä¹¦ï¼ˆLet's Encryptï¼‰
sudo apt install certbot python3-certbot-nginx -y

# ç”³è¯·è¯ä¹¦
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

## ðŸ“ OSSå¯¹è±¡å­˜å‚¨

### 1. åˆ›å»ºOSS Bucket

```bash
# åœ¨é˜¿é‡Œäº‘æŽ§åˆ¶å°åˆ›å»º
Bucketåç§°: ai-interview-files
å­˜å‚¨ç±»åž‹: æ ‡å‡†å­˜å‚¨
è¯»å†™æƒé™: ç§æœ‰
æœåŠ¡ç«¯åŠ å¯†: AES256
```

### 2. é…ç½®è®¿é—®æƒé™

```bash
# åˆ›å»ºRAMç”¨æˆ·
ç”¨æˆ·å: ai-interview-oss
æƒé™: AliyunOSSFullAccess

# èŽ·å–AccessKey
AccessKeyId: LTAIxxxxxxxxxx
AccessKeySecret: xxxxxxxxxxxxx
```

### 3. è·¨åŸŸé…ç½®

```json
{
  "CORSRule": [
    {
      "AllowedOrigin": ["https://yourdomain.com"],
      "AllowedMethod": ["GET", "POST", "PUT", "DELETE"],
      "AllowedHeader": ["*"],
      "ExposeHeader": ["ETag"],
      "MaxAgeSeconds": 3600
    }
  ]
}
```

## ðŸ“§ é‚®ä»¶æŽ¨é€æœåŠ¡

### 1. å¼€é€šæœåŠ¡

```bash
# åœ¨é˜¿é‡Œäº‘æŽ§åˆ¶å°å¼€é€šé‚®ä»¶æŽ¨é€æœåŠ¡
# éªŒè¯å‘ä¿¡åŸŸå
# é…ç½®SMTPè´¦å·
```

### 2. é…ç½®ä¿¡æ¯

```bash
SMTPæœåŠ¡å™¨: smtpdm.aliyun.com
ç«¯å£: 25 (æˆ– 80, 443)
åŠ å¯†æ–¹å¼: æ— éœ€åŠ å¯†
è®¤è¯: éœ€è¦è®¤è¯
```

## ðŸ”’ å®‰å…¨é…ç½®

### 1. å®‰å…¨ç»„è§„åˆ™

```bash
# å…¥æ–¹å‘è§„åˆ™
22/TCP    - SSHè®¿é—® (é™åˆ¶IP)
80/TCP    - HTTP
443/TCP   - HTTPS
3001/TCP  - APIæœåŠ¡ (ä»…å†…ç½‘)

# å‡ºæ–¹å‘è§„åˆ™
å…¨éƒ¨å…è®¸
```

### 2. é˜²ç«å¢™é…ç½®

```bash
# å¯ç”¨UFWé˜²ç«å¢™
sudo ufw enable

# å…è®¸SSH
sudo ufw allow 22

# å…è®¸HTTP/HTTPS
sudo ufw allow 80
sudo ufw allow 443

# æ£€æŸ¥çŠ¶æ€
sudo ufw status
```

## ðŸ“Š ç›‘æŽ§å’Œæ—¥å¿—

### 1. äº‘ç›‘æŽ§é…ç½®

```bash
# åœ¨é˜¿é‡Œäº‘æŽ§åˆ¶å°é…ç½®
- ECSç›‘æŽ§: CPUã€å†…å­˜ã€ç£ç›˜
- RDSç›‘æŽ§: è¿žæŽ¥æ•°ã€æ…¢æŸ¥è¯¢
- Redisç›‘æŽ§: å†…å­˜ä½¿ç”¨çŽ‡
- è´Ÿè½½å‡è¡¡ç›‘æŽ§: è¯·æ±‚é‡ã€é”™è¯¯çŽ‡
```

### 2. æ—¥å¿—ç®¡ç†

```bash
# æ—¥å¿—ç›®å½•
/var/log/nginx/          # Nginxæ—¥å¿—
./backend-api/logs/      # åº”ç”¨æ—¥å¿—

# æ—¥å¿—è½®è½¬é…ç½®
sudo cat > /etc/logrotate.d/ai-interview << EOF
/home/ubuntu/AI-Interview-System/backend-api/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    notifempty
    create 644 ubuntu ubuntu
    postrotate
        pm2 reloadLogs
    endscript
}
EOF
```

## ðŸš€ éƒ¨ç½²è„šæœ¬

### è‡ªåŠ¨éƒ¨ç½²è„šæœ¬

```bash
cat > deploy.sh << 'EOF'
#!/bin/bash

echo "ðŸš€ å¼€å§‹éƒ¨ç½²AIé¢è¯•ç³»ç»Ÿåˆ°é˜¿é‡Œäº‘..."

# æ›´æ–°ä»£ç 
git pull origin main

# åŽç«¯æž„å»º
cd backend-api
npm install --production
npm run build
npx prisma generate
npx prisma migrate deploy

# å‰ç«¯æž„å»º
cd ../admin-dashboard
npm install
npm run build

# éƒ¨ç½²å‰ç«¯é™æ€æ–‡ä»¶
sudo cp -r dist/* /var/www/ai-interview-admin/

# é‡å¯åŽç«¯æœåŠ¡
pm2 restart ai-interview-api

# é‡æ–°åŠ è½½Nginx
sudo nginx -s reload

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
EOF

chmod +x deploy.sh
```

## ðŸ”§ æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–

```sql
-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_user_email ON users(email);
CREATE INDEX idx_job_company ON jobs(companyId);
CREATE INDEX idx_interview_user ON interviews(userId);
CREATE INDEX idx_interview_company ON interviews(companyId);
```

### 2. Redisç¼“å­˜ç­–ç•¥

```javascript
// ç¼“å­˜çƒ­ç‚¹æ•°æ®
- ç”¨æˆ·ä¼šè¯: 30åˆ†é’Ÿ
- å²—ä½åˆ—è¡¨: 10åˆ†é’Ÿ
- ä¼ä¸šä¿¡æ¯: 1å°æ—¶
```

### 3. CDNé…ç½®

```bash
# é™æ€èµ„æºCDN
- JS/CSSæ–‡ä»¶
- å›¾ç‰‡èµ„æº
- å­—ä½“æ–‡ä»¶
```

## ðŸ“‹ ç»´æŠ¤æ¸…å•

### æ—¥å¸¸ç»´æŠ¤

- [ ] æ£€æŸ¥æœåŠ¡çŠ¶æ€
- [ ] ç›‘æŽ§ç³»ç»Ÿèµ„æºä½¿ç”¨
- [ ] æŸ¥çœ‹é”™è¯¯æ—¥å¿—
- [ ] å¤‡ä»½æ•°æ®åº“
- [ ] æ›´æ–°SSLè¯ä¹¦

### å®šæœŸç»´æŠ¤

- [ ] ç³»ç»Ÿå®‰å…¨æ›´æ–°
- [ ] ä¾èµ–åŒ…æ›´æ–°
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å®¹é‡è§„åˆ’
- [ ] ç¾å¤‡æ¼”ç»ƒ

## ðŸ†˜ æ•…éšœæŽ’æŸ¥

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿žæŽ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥å®‰å…¨ç»„é…ç½®
   # éªŒè¯è¿žæŽ¥å­—ç¬¦ä¸²
   # æŸ¥çœ‹RDSç™½åå•
   ```

2. **Redisè¿žæŽ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥å¯†ç é…ç½®
   # éªŒè¯ç½‘ç»œè¿žé€šæ€§
   # æŸ¥çœ‹Rediså®žä¾‹çŠ¶æ€
   ```

3. **æ–‡ä»¶ä¸Šä¼ å¤±è´¥**
   ```bash
   # æ£€æŸ¥OSSé…ç½®
   # éªŒè¯AccessKeyæƒé™
   # æŸ¥çœ‹è·¨åŸŸè®¾ç½®
   ```

---

## ðŸ“ž æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- ðŸ“§ æŠ€æœ¯æ”¯æŒ: tech-support@yourdomain.com
- ðŸ“± ç”µè¯æ”¯æŒ: 400-xxx-xxxx
- ðŸ’¬ åœ¨çº¿å®¢æœ: https://yourdomain.com/support 