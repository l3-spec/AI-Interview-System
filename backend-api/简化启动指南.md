# AI面试系统第4项功能 - 简化启动指南

## 🚀 3步快速启动

### 第一步：安装依赖
```bash
cd backend-api
npm install
```

### 第二步：配置环境变量

创建 `.env` 文件（复制 `env.example`）：
```bash
cp env.example .env
```

**必需配置（最小配置）：**
```bash
# 基础配置
NODE_ENV=development
PORT=3001
DATABASE_URL="file:./prisma/dev.db"  # 使用SQLite简化数据库
JWT_SECRET="your-jwt-secret-key"

# Deepseek API （必需）
DEEPSEEK_API_KEY="sk-your-deepseek-api-key"
DEEPSEEK_API_URL="https://api.deepseek.com/v1/chat/completions"
DEEPSEEK_MODEL="deepseek-chat"

# TTS配置（可选，不配置会使用模拟模式）
TTS_PROVIDER="aliyun"
# 以下为可选配置，不配置会使用模拟语音
# ALIYUN_TTS_ACCESS_KEY_ID="your-access-key-id"
# ALIYUN_TTS_ACCESS_KEY_SECRET="your-access-key-secret"
```

### 第三步：启动服务
```bash
# 初始化数据库
npm run prisma:generate
npm run prisma:migrate dev

# 初始化种子数据
npx ts-node prisma/seeds/jobTemplates.ts

# 启动服务
npm run dev
```

## 🎯 核心功能说明

### 1. Deepseek API配置（必需）

**获取方式：**
1. 访问 [Deepseek官网](https://platform.deepseek.com/)
2. 注册账号并完成实名认证
3. 进入控制台 → API Keys → 创建新密钥
4. 充值账户（最低10元即可测试）

**费用说明：**
- 按token计费，约0.002元/1000 tokens
- 每次面试（5个问题）约消耗0.01-0.02元

### 2. TTS语音服务（可选）

**不配置TTS：**
- 系统自动使用模拟模式
- 生成占位符音频文件
- 功能完全正常，只是语音为模拟文件

**配置阿里云TTS（推荐）：**
详见下方阿里云配置指南

## 🧪 测试验证

启动服务后，访问：
- **健康检查**: http://localhost:3001/health
- **API文档**: http://localhost:3001/api/docs

**测试API调用：**
```bash
# 测试创建面试会话（需要替换YOUR_JWT_TOKEN）
curl -X POST http://localhost:3001/api/ai-interview/create-session \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "jobTarget": "Java开发工程师",
    "questionCount": 3
  }'
```

## 🔑 阿里云TTS配置指南（可选）

### 1. 开通语音合成服务

1. **登录阿里云控制台**
   - 访问：https://ecs.console.aliyun.com/
   - 登录你的阿里云账号

2. **搜索并开通TTS服务**
   - 在控制台搜索框输入："语音合成" 或 "TTS"
   - 点击"智能语音交互" → "语音合成"
   - 点击"立即开通"按钮

3. **选择服务版本**
   - 选择"按量计费"（推荐测试使用）
   - 价格：4元/万字符，测试成本很低

### 2. 创建AccessKey

1. **进入访问控制**
   - 点击右上角头像 → "AccessKey管理"
   - 或访问：https://usercenter.console.aliyun.com/

2. **创建子用户（推荐）**
   - 点击"用户" → "创建用户"
   - 用户名：ai-interview-tts
   - 勾选"编程访问"
   - 保存AccessKey ID和Secret（只显示一次）

3. **授权TTS权限**
   - 点击创建的用户 → "添加权限"
   - 搜索并添加：`AliyunNlsFullAccess`

### 3. 获取配置信息

配置信息对应关系：
```bash
# 在用户管理页面获取
ALIYUN_TTS_ACCESS_KEY_ID="LTAI5t8n开头的字符串"
ALIYUN_TTS_ACCESS_KEY_SECRET="创建用户时显示的Secret"

# 固定配置
ALIYUN_TTS_REGION="cn-shanghai"      # 服务地域
ALIYUN_TTS_VOICE="siqi"              # 语音类型
ALIYUN_TTS_FORMAT="mp3"              # 音频格式
ALIYUN_TTS_SAMPLE_RATE="16000"       # 采样率
```

### 4. 验证配置

在 `.env` 文件中添加上述配置后，重启服务：
```bash
npm run dev
```

查看启动日志，应该看到：
```
✅ TTS服务已配置 (aliyun)，将使用真实服务
```

## ⚡ 常见问题

**Q: 为什么使用SQLite而不是MySQL？**
A: SQLite无需额外安装，适合快速测试。生产环境建议使用MySQL。

**Q: 不配置TTS服务会影响功能吗？**
A: 不会。系统会自动使用模拟模式，生成占位符音频文件，所有API功能完全正常。

**Q: Deepseek API调用失败怎么办？**
A: 检查API密钥是否正确，账户是否有余额。系统会自动使用备用问题模板。

**Q: 如何在生产环境部署？**
A: 修改 `.env` 中的 `NODE_ENV=production`，配置真实数据库URL，使用 `npm run build && npm start`。

---

**✅ 现在你可以直接启动AI面试系统，无需额外脚本！**

核心优势：
- 🚀 **3步启动** - 安装、配置、运行
- 🎯 **最小配置** - 只需Deepseek API即可使用
- 🔄 **渐进增强** - TTS可选配置，不影响核心功能
- 📊 **完整功能** - 智能问题生成、面试流程管理 